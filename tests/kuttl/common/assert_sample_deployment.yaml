#
# Check for:
#
# - 1 manilaAPI
# - 2 manilaScheduler
# - 3 manilaShares
# - 4 extraMounts

apiVersion: manila.openstack.org/v1beta1
kind: Manila
metadata:
   name: manila
   namespace: openstack
spec:
   customServiceConfig: |
      [ DEFAULT ]
      debug = true
   databaseInstance: openstack
   databaseUser: manila
   debug:
      dbInitContainer: false
      dbSync: false
   extraMounts:
      -  name: v1
         region: r1
         extraVol:
            -  propagation:
                  - Manila
               extraVolType: Ceph
               volumes:
                  -  name: ceph
                     projected:
                        sources:
                           -  secret:
                                 name: ceph-conf-files
               mounts:
                  -  name: ceph
                     mountPath: "/etc/ceph"
                     readOnly: true
   manilaAPI:
      containerImage: quay.io/podified-antelope-centos9/openstack-manila-api:current-podified
      customServiceConfig: '# add your customization here'
      debug:
         initContainer: false
         service: false
      replicas: 1
   manilaScheduler:
      containerImage: quay.io/podified-antelope-centos9/openstack-manila-scheduler:current-podified
      customServiceConfig: '# add your customization here'
      debug:
         initContainer: false
         service: false
      replicas: 1
   manilaShares:
      share1:
         containerImage: quay.io/podified-antelope-centos9/openstack-manila-share:current-podified
         replicas: 1
         customServiceConfig: |
            [ DEFAULT ]
            enabled_share_backends=cephfs
            [cephfs]
            driver_handles_share_servers=False
            share_backend_name=cephfs
            share_driver=manila.share.drivers.cephfs.driver.CephFSDriver
            cephfs_conf_path=/etc/ceph/ceph.conf
            cephfs_auth_id=openstack
            cephfs_cluster_name=ceph
            cephfs_enable_snapshots=True
            cephfs_volume_mode=0755
            cephfs_protocol_helper_type=CEPHFS
   passwordSelectors:
      database: ManilaDatabasePassword
      service: ManilaPassword
   preserveJobs: false
   rabbitMqClusterName: rabbitmq
   secret: osp-secret
   serviceUser: manila
